<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Puzzle Pro - Swipe Edition</title>
<style>
  :root { --neon: #00f2ff; --bg: #080a0c; --card: #1c2128; --accent: #2ecc71; --gold: #f1c40f; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
  
  body { 
    margin:0; background: var(--bg); font-family: 'Segoe UI', sans-serif; 
    display:flex; justify-content:center; align-items:center; height:100vh; 
    color:white; overflow:hidden; touch-action: none;
  }

  /* CUSTOM ALERT POPUP */
  #winPopup {
    position: fixed; inset: 0; background: rgba(0,0,0,0.85);
    display: none; flex-direction: column; justify-content: center; align-items: center;
    z-index: 4000; backdrop-filter: blur(5px);
  }
  .win-modal {
    background: var(--card); padding: 30px; border-radius: 20px;
    border: 2px solid var(--neon); text-align: center; width: 280px;
    box-shadow: 0 0 20px rgba(0,242,255,0.2);
  }

  #loading { position:fixed; inset:0; background:radial-gradient(circle, #1c2128 0%, #000 100%); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index: 3000; }
  .loader-box { position: relative; width: 100px; height: 100px; border: 3px solid var(--neon); border-radius: 20%; animation: rotate 2s infinite linear; margin-bottom: 30px; }
  @keyframes rotate { 100% { transform: rotate(360deg); } }
  .loading-name { font-weight: bold; letter-spacing: 2px; color: #555; font-size: 12px; margin-top: 15px; }

  #menu, #game, #settings-page { width: 90%; max-width: 360px; display: none; flex-direction: column; align-items: center; }
  .top-bar { display: flex; justify-content: space-between; width: 100%; align-items: center; margin-bottom: 10px; }
  
  .setting-row { display: flex; justify-content: space-between; width: 100%; padding: 15px; background: var(--card); border-radius: 12px; margin-bottom: 10px; border: 1px solid #30363d; }
  .switch { width: 40px; height: 20px; background: #333; border-radius: 20px; position: relative; cursor: pointer; }
  .switch.on { background: var(--accent); }
  .switch::after { content: ''; position: absolute; width: 16px; height: 16px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: 0.3s; }
  .switch.on::after { left: 22px; }

  .ahmed-branding {
    margin-top: 20px; font-weight: 900; font-size: 18px; letter-spacing: 1px;
    background: linear-gradient(90deg, #fff, var(--neon), #fff);
    background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    animation: moveText 3s linear infinite;
  }
  @keyframes moveText { to { background-position: 200% center; } }

  .grid { display:grid; gap:8px; background: #010409; padding: 12px; border-radius: 20px; border: 1px solid #30363d; width: 100%; }
  .tile { 
    background: #21262d; border-radius: 12px; height: 85px; display:flex; justify-content:center; 
    align-items:center; font-size:26px; border: 1px solid #30363d; color: var(--neon);
    transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1); position: relative;
    user-select: none;
  }
  .empty { background: rgba(255,255,255,0.03); border: 1px dashed #222; }
  .hint-num { position: absolute; font-size: 10px; color: #444; bottom: 5px; right: 8px; font-weight: bold; }

  .btn { width: 100%; padding: 15px; margin: 8px; border-radius: 12px; background: var(--card); color: white; border: 1px solid rgba(255,255,255,0.1); font-weight: bold; text-transform: uppercase; cursor: pointer; }
  .btn-next { background: var(--neon); color: black; border: none; margin-top: 15px; }
</style>
</head>
<body>

<div id="winPopup">
  <div class="win-modal">
    <div style="font-size: 40px;">üèÜ</div>
    <h2 style="margin: 10px 0; color: var(--neon);">Well Done!</h2>
    <p style="color: #ccc; font-size: 14px;">Level completed successfully.</p>
    <button class="btn btn-next" onclick="nextLevel()">Next Level</button>
  </div>
</div>

<div id="loading">
  <div class="loader-box"></div>
  <div style="font-size: 24px; font-weight: 900;">PUZZLE<span style="color:var(--neon)">PRO</span></div>
  <div class="loading-name">CREATED BY AHMED ALI ASIF</div>
  <div style="width: 150px; height: 2px; background: #222; margin-top: 20px; border-radius: 5px; overflow: hidden;">
    <div id="lfill" style="width: 0%; height: 100%; background: var(--neon);"></div>
  </div>
</div>

<div id="settings-page">
  <h2 style="margin-bottom: 30px;">SETTINGS</h2>
  <div class="setting-row">
    <span>Sound Effects</span>
    <div id="soundToggle" class="switch on" onclick="toggleSound()"></div>
  </div>
  <div class="setting-row">
    <span>Vibration</span>
    <div id="vibToggle" class="switch on" onclick="toggleVib()"></div>
  </div>
  <button class="btn" onclick="showMenu()" style="margin-top: 20px;">Save & Back</button>
</div>

<div id="menu">
  <div style="font-size: 36px; font-weight: 900; margin-bottom: 40px;">PUZZLE<span style="color:var(--neon)">PRO</span></div>
  <button class="btn" onclick="startGame('easy')">Easy Mode</button>
  <button class="btn" onclick="startGame('medium')">Medium Mode</button>
  <button class="btn" onclick="startGame('hard')">Hard Mode</button>
  <button class="btn" onclick="showSettings()" style="background:none; border:none; color:#555;">Settings</button>
  <div class="ahmed-branding">Created by Ahmed Ali Asif</div>
</div>

<div id="game">
  <div class="top-bar">
    <button onclick="location.reload()" style="background:none; border:none; color:white; font-size:20px;">‚úï</button>
    <div style="font-size:14px; color:var(--neon); font-weight:bold;">LVL: <span id="lvlTxt">1</span></div>
    <button onclick="showSettings()" style="background:none; border:none; color:white;">‚öôÔ∏è</button>
  </div>
  
  <div style="display: flex; gap: 15px; margin-bottom: 15px;">
    <div style="text-align:center"><div style="font-size:10px; color:#555">TIME</div><div id="timer" style="font-weight:bold">0s</div></div>
    <div style="text-align:center"><div style="font-size:10px; color:#555">SCORE</div><div id="scoreTxt" style="font-weight:bold">0</div></div>
  </div>

  <div class="grid" id="grid"></div>
  
  <div style="margin-top: 15px; font-size: 11px; color: #555;">Hint: Swipe block towards the empty space.</div>
  <div class="ahmed-branding">Created by Ahmed Ali Asif</div>
</div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, type, dur) {
  if(!gameSettings.sound) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
  gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.start(); osc.stop(audioCtx.currentTime + dur);
}

let gameSettings = { sound: true, vib: true };
let stats = { easy: { lvl: 1, score: 0, g: 3 }, medium: { lvl: 1, score: 0, g: 2 }, hard: { lvl: 1, score: 0, g: 1 } };
let currentMode = 'easy', gridSize = 3, tileArr = [], time = 0, clock, isRunning = false;
let startX, startY;

let prog = 0;
const loadInt = setInterval(() => {
  prog += 10; document.getElementById('lfill').style.width = prog + '%';
  if(prog >= 100) { clearInterval(loadInt); showMenu(); }
}, 100);

function showMenu() {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('settings-page').style.display = 'none';
  document.getElementById('game').style.display = 'none';
  document.getElementById('menu').style.display = 'flex';
}

function showSettings() {
  document.getElementById('menu').style.display = 'none';
  document.getElementById('game').style.display = 'none';
  document.getElementById('settings-page').style.display = 'flex';
}

function toggleSound() {
  gameSettings.sound = !gameSettings.sound;
  document.getElementById('soundToggle').classList.toggle('on');
  if(gameSettings.sound) playSound(600, 'sine', 0.1);
}

function toggleVib() {
  gameSettings.vib = !gameSettings.vib;
  document.getElementById('vibToggle').classList.toggle('on');
}

function startGame(m) {
  currentMode = m;
  document.getElementById('menu').style.display = 'none';
  document.getElementById('game').style.display = 'flex';
  initLevel();
}

function initLevel() {
  let s = stats[currentMode];
  gridSize = s.lvl <= 2 ? 3 : (s.lvl <= 5 ? 4 : 5);
  document.getElementById('lvlTxt').innerText = s.lvl;
  document.getElementById('grid').style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
  tileArr = [];
  for(let i=1; i<=(gridSize*gridSize - s.g); i++) tileArr.push(i);
  for(let i=0; i<s.g; i++) tileArr.push("");
  time = 0; document.getElementById('timer').innerText = "0s"; isRunning = false; clearInterval(clock);
  shuffle();
}

function shuffle() { tileArr.sort(() => Math.random() - 0.5); render(); }

function render() {
  const container = document.getElementById('grid');
  container.innerHTML = "";
  tileArr.forEach((val, idx) => {
    const el = document.createElement('div');
    el.className = val === "" ? "tile empty" : "tile";
    el.innerText = val;
    
    if(idx < (gridSize*gridSize - stats[currentMode].g)) {
        const hint = document.createElement('span');
        hint.className = "hint-num";
        hint.innerText = idx + 1;
        el.appendChild(hint);
    }

    el.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
    }, {passive: true});

    el.addEventListener('touchend', (e) => {
        let endX = e.changedTouches[0].clientX;
        let endY = e.changedTouches[0].clientY;
        analyzeFinger(idx, startX, startY, endX, endY);
    });

    el.onclick = () => moveTile(idx); 
    container.appendChild(el);
  });
}

function analyzeFinger(idx, sx, sy, ex, ey) {
  let dx = ex - sx;
  let dy = ey - sy;
  let absX = Math.abs(dx);
  let absY = Math.abs(dy);
  if (absX < 30 && absY < 30) return;

  let r = Math.floor(idx / gridSize);
  let c = idx % gridSize;
  let targetIdx = -1;

  if (absX > absY) {
    if (dx > 0 && c < gridSize - 1) targetIdx = idx + 1;
    else if (dx < 0 && c > 0) targetIdx = idx - 1;
  } else {
    if (dy > 0 && r < gridSize - 1) targetIdx = idx + gridSize;
    else if (dy < 0 && r > 0) targetIdx = idx - gridSize;
  }

  if (targetIdx !== -1 && tileArr[targetIdx] === "") {
      performMove(idx, targetIdx);
  } else {
      playSound(150, 'sine', 0.1);
  }
}

function performMove(idx, target) {
  if(!isRunning) startTimer();
  [tileArr[idx], tileArr[target]] = [tileArr[target], tileArr[idx]];
  playSound(400, 'square', 0.05);
  if(gameSettings.vib && window.navigator.vibrate) window.navigator.vibrate(15);
  stats[currentMode].score += 5;
  document.getElementById('scoreTxt').innerText = stats[currentMode].score;
  render();
  checkWin();
}

function startTimer() {
    isRunning = true;
    clock = setInterval(() => { 
        time++; 
        document.getElementById('timer').innerText = time + 's'; 
    }, 1000);
}

function moveTile(idx) {
    let r = Math.floor(idx/gridSize), c = idx%gridSize;
    let neighbors = [idx-1, idx+1, idx-gridSize, idx+gridSize];
    for(let n of neighbors) {
        if(n >= 0 && n < gridSize*gridSize && tileArr[n] === "") {
            let nr = Math.floor(n/gridSize), nc = n%gridSize;
            if(Math.abs(r-nr) + Math.abs(c-nc) === 1) {
                performMove(idx, n);
                return;
            }
        }
    }
}

function checkWin() {
  let limit = (gridSize*gridSize) - stats[currentMode].g;
  for(let i=0; i<limit; i++) if(tileArr[i] !== i+1) return;
  
  clearInterval(clock);
  playSound(800, 'triangle', 0.3);
  // SHOW CUSTOM POPUP
  document.getElementById('winPopup').style.display = 'flex';
}

function nextLevel() {
  document.getElementById('winPopup').style.display = 'none';
  stats[currentMode].lvl++;
  initLevel();
}
</script>
</body>
</html>
